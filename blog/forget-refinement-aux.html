<!DOCTYPE html>
<html data-bulma-theme="light">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="icon" href="../img/favicon.ico" sizes="32x32">
  <link rel="icon" href="../img/favicon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="../img/apple-touch-icon.png">

  <script src="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/js/all.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/fontawesome.min.css"
    rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:500">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.28/dist/katex.min.css" integrity="sha384-Wsr4Nh3yrvMf2KCebJchRJoVo1gTU6kcP05uRSh5NV3sj9+a8IomuJoQzf3sMq4T" crossorigin="anonymous">

  <link rel="stylesheet" href="../main.css">
  <link rel="stylesheet" href="../css/code.css">
  <link rel="stylesheet" href="../search/docs.css">
  <script src="../main.js"></script>

  <title>What happens when I forget a refinement?</title>
</head>

<body class="bulma-is-flex bulma-is-flex-direction-column">
  <nav class="bulma-navbar" role="navigation" aria-label="main navigation">
  <div class="bulma-navbar-brand">
    <a class="bulma-navbar-item" href="../">
      <img src="../img/logo.svg" />
    </a>

    <a role="button" class="bulma-navbar-burger" aria-label="menu" aria-expanded="false" data-target="navMenu"
      onClick="handleBurgerClick(this)">
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </a>
  </div>
  <div class="bulma-navbar-menu" id="navMenu">
    <div class="bulma-navbar-start">

    </div>
    <div class="bulma-navbar-end">
      <div class="bulma-navbar-item"><a class="bulma-button bulma-is-rounded bulma-is-primary bulma-has-text-light">Get Started</a></div>
      <div class="bulma-navbar-item"><a class="bulma-button bulma-is-text">Learn</a></div>
      <div class="bulma-navbar-item"><a class="bulma-button bulma-is-text">Community</a></div>
      <div class="bulma-navbar-item"><a class="bulma-button bulma-is-text" href="../foundation/">Foundation</a></div>
      <div class="bulma-navbar-item"><a class="bulma-button bulma-is-text" href="index.html">Blog</a></div>
      <div class="bulma-navbar-item">
        <a id="search-top-bar" class="bulma-button bulma-is-text" aria-label="Search" onclick="showSearchModal()">
          <span class="bulma-icon bulma-is-small">
            <i class="fas fa-magnifying-glass"></i>
          </span>
        </a>
      </div>
    </div>
  </div>
</nav>

<!-- Search Modal -->
<div id="search-modal" class="bulma-modal bulma-is-justify-content-flex-start bulma-pt-6 bulma-pb-6">
  <div class="bulma-modal-background bulma-is-align-items-flex-start" onclick="hideSearchModal()"></div>
  <div class="bulma-modal-card">
    <header class="bulma-modal-card-head">
      <p class="bulma-control bulma-has-icons-left bulma-is-flex-grow-1">
        <input id="search-input" class="bulma-input bulma-is-medium bulma-is-primary" type="search" autocomplete="off" oninput="onSearchInput(event)">
        <span class="bulma-icon bulma-is-left bulma-has-text-primary">
          <i class="fas fa-magnifying-glass"></i>
        </span>
      </p>
    </header>
    <section id="search-results" class="bulma-modal-card-body">
    </section>
    <footer class="bulma-modal-card-foot bulma-is-justify-content-space-between">
      <span class="bulma-has-text-grey bulma-is-size-7">
        <kbd class="bulma-tag">/</kbd> to open search &nbsp;
        <kbd class="bulma-tag">Esc</kbd> to close
      </span>
    </footer>
  </div>
</div>

  <main class="bulma-is-flex-grow-1">
    
<section class="bulma-hero bulma-is-primary bulma-is-bold">
  <div class="bulma-hero-body bulma-container bulma-is-max-desktop">
    <p class="bulma-title bulma-has-text-light">What happens when I forget a refinement?</p>
    <p class="blog-post-byline bulma-has-text-light bulma-subtitle">
      by
      
        Stephen Compall<span class="delimiter">,</span><span class="last-delimiter"> &</span>
      
      on July 19, 2015
    </p>
     
      <span class="bulma-tag">technical</span>
     
  </div>
</section>
<div class="bulma-section bulma-container bulma-is-max-desktop">
  <div class="blog-post bulma-content">
    <h1 id="what-happens-when-i-forget-a-refinement" class="title">What happens when I forget a refinement?</h1>
    <p><em>This is the third of a series of articles on “Type Parameters and
    Type Members”.  If you haven’t yet, you should
    <a href="type-members-parameters.html">start at the beginning</a>,
    which introduces code we refer to throughout this article without
    further ado.</em></p>
    <p>As I mentioned
    <a href="method-equiv.html#when-are-two-methods-less-alike">in the previous article</a>,
    the error of the <code>mdropFirstE</code> signature, taking <code>MList</code> and returning
    merely <code>MList</code>, was to fail to relate the input element type to the
    output element type.  This mistake is an easy one to make when failure
    is the default behavior.</p>
    <p>By contrast, <strong>when we try this with <code>PList</code>, the compiler helpfully
    points out our error</strong>.</p>
    <pre><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">pdropFirst</span><span>(</span><span class="identifier">xs</span><span>: </span><span class="type-name">PList</span><span>): </span><span class="type-name">PList</span><span> = ???

</span><span class="type-name">TmTp3</span><span>.</span><span class="identifier">scala</span><span>:</span><span class="number-literal">6</span><span>: </span><span class="keyword">class</span><span> </span><span class="type-name">PList</span><span> </span><span class="identifier">takes</span><span> </span><span class="keyword">type</span><span> </span><span class="identifier">parameters</span><span>
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">pdropFirst</span><span>(</span><span class="identifier">xs</span><span>: </span><span class="type-name">PList</span><span>): </span><span class="type-name">PList</span><span> = ???
                             ^
</span><span class="type-name">TmTp3</span><span>.</span><span class="identifier">scala</span><span>:</span><span class="number-literal">6</span><span>: </span><span class="keyword">class</span><span> </span><span class="type-name">PList</span><span> </span><span class="identifier">takes</span><span> </span><span class="keyword">type</span><span> </span><span class="identifier">parameters</span><span>
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">pdropFirst</span><span>(</span><span class="identifier">xs</span><span>: </span><span class="type-name">PList</span><span>): </span><span class="type-name">PList</span><span> = ???
                     ^</span></code></pre>
    
    <h2 id="what-happens-when-i-misspell-a-refinement" class="section"><a class="anchor-link" href="#what-happens-when-i-misspell-a-refinement"><code class="fas fa-link fa-sm"></code></a>What happens when I misspell a refinement?</h2>
    <p>There is another mistake that type members open you up to. I have been
    using the very odd type parameter—and member—name&nbsp;<code>T</code>.
    Java&nbsp;developers will find this choice very ordinary, but the name of
    choice for the discerning Scala programmer is&nbsp;<code>A</code>.  So suppose I
    attempted to correct <code>mdropFirstE</code>’s type as follows:</p>
    <pre><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">mdropFirstE2</span><span>[</span><span class="type-name">T0</span><span>](</span><span class="identifier">xs</span><span>: </span><span class="type-name">MList</span><span> {</span><span class="keyword">type</span><span> </span><span class="type-name">A</span><span> = </span><span class="type-name">T0</span><span>}) =
  </span><span class="identifier">xs</span><span>.</span><span class="identifier">uncons</span><span> </span><span class="keyword">match</span><span> {
    </span><span class="keyword">case</span><span> </span><span class="type-name">None</span><span> =&gt; </span><span class="type-name">MNil</span><span>()
    </span><span class="keyword">case</span><span> </span><span class="type-name">Some</span><span>(</span><span class="identifier">c</span><span>) =&gt; </span><span class="identifier">c</span><span>.</span><span class="identifier">tail</span><span>
  }</span></code></pre>
    <p>This method compiles, but I cannot invoke it!</p>
    <pre><code class="nohighlight"><span>&gt; </span><span class="identifier">mdropFirstE2</span><span>(</span><span class="type-name">MNil</span><span>[</span><span class="type-name">Int</span><span>]())
&lt;</span><span class="identifier">console</span><span>&gt;:</span><span class="number-literal">20</span><span>: </span><span class="identifier">error</span><span>: </span><span class="keyword">type</span><span> </span><span class="identifier">mismatch</span><span>;
 </span><span class="identifier">found</span><span>   : </span><span class="identifier">tmtp</span><span>.</span><span class="type-name">MNil</span><span>{</span><span class="keyword">type</span><span> </span><span class="type-name">T</span><span> = </span><span class="type-name">Int</span><span>}
 </span><span class="identifier">required</span><span>: </span><span class="identifier">tmtp</span><span>.</span><span class="type-name">MList</span><span>{</span><span class="keyword">type</span><span> </span><span class="type-name">A</span><span> = ?}
       </span><span class="identifier">mdropFirstE2</span><span>(</span><span class="type-name">MNil</span><span>[</span><span class="type-name">Int</span><span>]())
                             ^

&gt; </span><span class="identifier">mdropFirstE2</span><span>(</span><span class="type-name">MCons</span><span>[</span><span class="type-name">Int</span><span>](</span><span class="number-literal">42</span><span>, </span><span class="type-name">MNil</span><span>[</span><span class="type-name">Int</span><span>]()))
&lt;</span><span class="identifier">console</span><span>&gt;:</span><span class="number-literal">20</span><span>: </span><span class="identifier">error</span><span>: </span><span class="keyword">type</span><span> </span><span class="identifier">mismatch</span><span>;
 </span><span class="identifier">found</span><span>   : </span><span class="identifier">tmtp</span><span>.</span><span class="type-name">MCons</span><span>{</span><span class="keyword">type</span><span> </span><span class="type-name">T</span><span> = </span><span class="type-name">Int</span><span>}
 </span><span class="identifier">required</span><span>: </span><span class="identifier">tmtp</span><span>.</span><span class="type-name">MList</span><span>{</span><span class="keyword">type</span><span> </span><span class="type-name">A</span><span> = ?}
       </span><span class="identifier">mdropFirstE2</span><span>(</span><span class="type-name">MCons</span><span>[</span><span class="type-name">Int</span><span>](</span><span class="number-literal">42</span><span>, </span><span class="type-name">MNil</span><span>[</span><span class="type-name">Int</span><span>]()))
                              ^</span></code></pre>
    <p>That’s because <code>MList&nbsp;{type&nbsp;A&nbsp;=&nbsp;T0}</code> is a perfectly reasonable
    intersection type: values of this type have <em>both</em> the type <code>MList</code> in
    their supertype&nbsp;tree somewhere, <em>and</em> a type member named&nbsp;<code>A</code>, which
    is bound&nbsp;to&nbsp;<code>T0</code>.  In terms of subtyping relationships:</p>
    <pre><code class="nohighlight"><span class="type-name">MList</span><span> {</span><span class="keyword">type</span><span> </span><span class="type-name">A</span><span> = </span><span class="type-name">T0</span><span>} &lt;: </span><span class="type-name">MList</span><span>
</span><span class="comment">// and unrelatedly,
</span><span class="type-name">MList</span><span> {</span><span class="keyword">type</span><span> </span><span class="type-name">A</span><span> = </span><span class="type-name">T0</span><span>} &lt;: {</span><span class="keyword">type</span><span> </span><span class="type-name">A</span><span> = </span><span class="type-name">T0</span><span>}</span></code></pre>
    <p>That <code>MList</code> has no such type member&nbsp;<code>A</code> is irrelevant to the
    intersection and refinement of types in Scala.  This type means “an
    instance of the trait <code>MList</code>, with a type member named&nbsp;<code>A</code> set
    to&nbsp;<code>T0</code>”.  This type member&nbsp;<code>A</code> could come from another trait mixed
    with <code>MList</code> or an inline subclass.  Whether such a thing is
    impossible to instantiate—due to <code>sealed</code>, <code>final</code>, or anything
    else—is also irrelevant; <strong>types with no values are meaningful and
    useful in both Java and Scala</strong>.</p>
    
    <h2 id="why-t0-what-s-aux" class="section"><a class="anchor-link" href="#why-t0-what-s-aux"><code class="fas fa-link fa-sm"></code></a>Why <code>T0</code>?  What’s <code>Aux</code>?</h2>
    <p>A few of the methods on <code>MList</code> we have seen so far take a type
    parameter <code>T0</code> instead of <code>T</code>.  This is just a mnemonic trick; I’m
    saying “I would write <code>T</code> here if <code>scalac</code> would let me”, which I have
    borrowed from
    <a href="https://github.com/scalaz/scalaz/blob/v7.1.3/core/src/main/scala/scalaz/Unapply.scala#L217"><code>scalaz.Unapply</code></a>.
    Let’s try to implement <code>def&nbsp;MNil</code> taking a <code>T</code> instead.</p>
    <pre><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">MNil</span><span>[</span><span class="type-name">T</span><span>](): </span><span class="type-name">MNil</span><span> {</span><span class="keyword">type</span><span> </span><span class="type-name">T</span><span> = </span><span class="type-name">T</span><span>} =
  </span><span class="keyword">new</span><span> </span><span class="type-name">MNil</span><span> {
    </span><span class="keyword">type</span><span> </span><span class="type-name">T</span><span> = </span><span class="type-name">T</span><span>
  }

</span><span class="comment">// Scala complains, though:
</span><span class="type-name">TmTp3</span><span>.</span><span class="identifier">scala</span><span>:</span><span class="number-literal">15</span><span>: </span><span class="identifier">illegal</span><span> </span><span class="identifier">cyclic</span><span> </span><span class="identifier">reference</span><span> </span><span class="identifier">involving</span><span> </span><span class="keyword">type</span><span> </span><span class="type-name">T</span><span>
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">MNil</span><span>[</span><span class="type-name">T</span><span>](): </span><span class="type-name">MNil</span><span> {</span><span class="keyword">type</span><span> </span><span class="type-name">T</span><span> = </span><span class="type-name">T</span><span>} =
                                ^</span></code></pre>
    <p>This is a scoping problem; the refinement type makes the member&nbsp;<code>T</code>
    shadow our method type parameter&nbsp;<code>T</code>.  We dealt with the problem in
    <code>MList#uncons</code> and <code>MCons#tail</code> as well, way back in section “Two
    lists, all alike” of
    <a href="type-members-parameters.html#two-lists-all-alike">the first part</a>,
    in those cases by outer-scoping the <code>T</code> as
    <code>self.T</code> instead.</p>
    <p><strong>When defining a type with members, you should define an <code>Aux</code> type
    in your companion that converts the member to a type parameter.</strong> The
    name <code>Aux</code> is a convention I have borrowed from
    <a href="https://github.com/milessabin/shapeless/blob/shapeless-2.2.4/core/src/main/scala/shapeless/ops/hlists.scala#L1501">Shapeless ops</a>.
    This is pretty much boilerplate; in this case, add this to
    <code>object&nbsp;MList</code>:</p>
    <pre><code class="nohighlight"><span class="keyword">type</span><span> </span><span class="type-name">Aux</span><span>[</span><span class="type-name">T0</span><span>] = </span><span class="type-name">MList</span><span> {</span><span class="keyword">type</span><span> </span><span class="type-name">T</span><span> = </span><span class="type-name">T0</span><span>}</span></code></pre>
    <p>Now you can write <code>MList.Aux[Int]</code> instead of <code>MList&nbsp;{type&nbsp;T&nbsp;=&nbsp;Int}</code>.
    Here’s <code>mdropFirstT</code>’s signature rewritten in this style.</p>
    <pre><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">mdropFirstT2</span><span>[</span><span class="type-name">T</span><span>](</span><span class="identifier">xs</span><span>: </span><span class="type-name">MList</span><span>.</span><span class="type-name">Aux</span><span>[</span><span class="type-name">T</span><span>]): </span><span class="type-name">MList</span><span>.</span><span class="type-name">Aux</span><span>[</span><span class="type-name">T</span><span>] = ???</span></code></pre>
    <p>Furthermore, because the member&nbsp;<code>T</code> is not in scope for <code>Aux</code>’s type
    parameter position, you can take method type parameters named&nbsp;<code>T</code> and
    sensibly write <code>MList.Aux[T]</code> without the above error.  You can see
    this in the immediately preceding example.  But, stepping back a bit,
    this should be considered an advantage for type parameters more
    generally; <code>PList</code> doesn’t have this&nbsp;problem in the first place.</p>
    <p><strong>Using <code>Aux</code> also helps you avoid the errors of forgetting to specify
    or misspelling a type member</strong>, as described at the beginning of this
    article.  With <code>Aux</code>, as with ordinary parameterized&nbsp;types, a missing
    argument is caught by the compiler, and misspelling the parameter name
    is impossible.</p>
    <p>In
    <a href="type-projection.html">the next part, “Type projection isn’t that specific”</a>,
    we’ll see why something that, at first glance, seems
    like a workable alternative to either refinement or the <code>Aux</code> trick,
    doesn’t work out as well as people wish it would.</p>
    <p><em>This article was tested with Scala 2.11.7.</em></p>
  </div>
</div>
<div class="bulma-section bulma-container bulma-is-max-desktop">
  <div class="bulma-columns">
    
    <div class="bulma-column">
      <article class="bulma-media">
  
  <figure class="bulma-media-left">
    <p class="bulma-image bulma-is-64x64">
      <img class="bulma-is-rounded" src="https://github.com/S11001001.png" />
    </p>
  </figure>
  
  <div class="bulma-media-content">
    <div class="bulma-content">
      <p>
        <strong>Stephen Compall</strong>
        
      </p>
    </div>
    <nav class="bulma-level bulma-is-align-items-start">
      <div class="bulma-level-left bulma-is-flex-direction-row">
        
        
        <a class="bulma-level-item" href="http://github.com/S11001001">
          <span class="bulma-icon bulma-is-small"><i class="fab fa-github"></i></span>
        </a>
        
        
        
        
      </div>
    </nav>
  </div>
</article>

    </div>
    
  </div>
</div>


  </main>
  <footer class="bulma-footer">
  <div class="bulma-columns">
    <div class="bulma-column bulma-is-half">
      Copyright 2026 Typelevel Foundation and <a href="https://github.com/typelevel/typelevel.github.com/graphs/contributors">contributors</a>.
      Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> unless <a href="../colophon.html#license">noted otherwise</a>.
    </div>
    <div class="bulma-column">
      <ul>
        <li><a href="../projects/">Project Index</a></li>
        <li><a href="#">Documentation</a></li>
        <li><a href="#">Contributing</a></li>
      </ul>
    </div>
    <div class="bulma-column">
      <ul>
        <li><a href="../code-of-conduct/">Code of Conduct</a></li>
        <li><a href="../security.html">Security Policy</a></li>
        <li><a href="../colophon.html">Colophon</a></li>
      </ul>
    </div>
  </div>
  <div class="bulma-has-text-centered">
    <div>Find us on ...</div>
    <div>
      <a class="bulma-icon bulma-is-large bulma-has-text-current" href="https://github.com/typelevel">
        <i class="fab fa-github fa-2x"></i>
      </a>
      <a class="bulma-icon bulma-is-large bulma-has-text-current" href="https://discord.gg/pey2hnSQGS">
        <i class="fab fa-discord fa-2x"></i>
      </a>
      <a class="bulma-icon bulma-is-large bulma-has-text-current" href="https://bsky.app/profile/typelevel.org">
        <i class="fab fa-bluesky fa-2x"></i>
      </a>
      <a class="bulma-icon bulma-is-large bulma-has-text-current" href="https://fosstodon.org/@typelevel">
        <i class="fab fa-mastodon fa-2x"></i>
      </a>
      <a class="bulma-icon bulma-is-large bulma-has-text-current" href="https://www.youtube.com/@typelevel">
        <i class="fab fa-youtube fa-2x"></i>
      </a>
      <a class="bulma-icon bulma-is-large bulma-has-text-current"
        href="https://linkedin.com/company/typelevel-foundation">
        <i class="fab fa-linkedin fa-2x"></i>
      </a>
    </div>
  </div>
</footer>

</body>

</html>

